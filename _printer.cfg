[include mainsail.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_1F0014000851323235363233-if00

[force_move] 
enable_force_move: true 

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevH_8BCA20FE5157355957202020FF0F3719-if00
x_offset: 0
y_offset: 27.065
mesh_main_direction: x
mesh_runs: 2

[safe_z_home]
home_xy_position: 175,175
z_hop: 3
speed: 300

[resonance_tester]
accel_chip: adxl345
probe_points: 180, 180, 20

[input_shaper]
shaper_freq_x: 66.6
shaper_type_x: zv
shaper_freq_y: 43
shaper_type_y: zv

[bed_mesh]
speed: 350
mesh_min: 50, 35
mesh_max: 340, 330
probe_count: 20,20
algorithm: bicubic

[mcu EBBCan]
canbus_uuid: af1be5c02d14

[extruder]
step_pin: EBBCan: PD0
dir_pin: !EBBCan: PD1
enable_pin: !EBBCan: PD2
full_steps_per_rotation: 200
rotation_distance: 22.043
gear_ratio: 50:8
microsteps: 32
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: EBBCan: PB13
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: EBBCan: PA3
control: pid
pid_Kp: 21.527
pid_Ki: 1.063
pid_Kd: 108.982
min_temp: 10
max_temp: 300
min_extrude_temp: 150

[tmc2209 extruder]
uart_pin: EBBCan: PA15
run_current: 0.7

[adxl345]
cs_pin: EBBCan: PB12
spi_software_sclk_pin: EBBCan: PB10
spi_software_mosi_pin: EBBCan: PB11
spi_software_miso_pin: EBBCan: PB2
axes_map: x,y,z

[fan]
pin: EBBCan: PA1

[heater_fan hotend_fan]
pin: EBBCan: PA0
heater: extruder
heater_temp: 40.0

[stepper_x] # Driver0, Motor1, X Left Motor
step_pin: PF13
dir_pin: !PF12
enable_pin: !PF14
microsteps: 16
rotation_distance: 40
full_steps_per_rotation: 200
endstop_pin: EBBCan: PB6
position_endstop: 380
position_min: -10
position_max: 385
homing_speed: 150

[stepper_y] # Driver1, Motor 2, Y Right Motor
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
microsteps: 16
rotation_distance: 40
full_steps_per_rotation: 200
endstop_pin: PG6
position_endstop: 390
position_min: -10
position_max: 395
homing_speed: 150

[stepper_z] # Driver2, Motor 3, Z Left Motor
step_pin: PF11
dir_pin: !PG3
enable_pin: !PG5
microsteps: 16
rotation_distance: 4
position_max: 400
endstop_pin: probe:z_virtual_endstop
homing_retract_dist: 0

[stepper_z1] # Driver3, Motor 4, Z Right Motor
step_pin: PG4
dir_pin: PC1
enable_pin: !PA2
microsteps: 16
rotation_distance: 4

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
sensor_type: ATC Semitec 104GT-2
control: watermark
min_temp: 0
max_temp: 130

[controller_fan fan1]
pin: PA8

[controller_fan fan2]
pin: PE5

[controller_fan fan3]
pin: PD12

[printer]
kinematics: corexy
max_velocity: 1000
max_accel: 40000
max_z_velocity: 18
max_z_accel: 200

[tmc5160 stepper_x]
cs_pin: PC4
spi_bus: spi1
sense_resistor: 0.022
run_current: 2
#stealthchop_threshold: 999999

[tmc5160 stepper_y]
cs_pin: PF2
spi_bus: spi1
sense_resistor: 0.022
run_current: 2
#stealthchop_threshold: 999999

[tmc2209 stepper_z]
uart_pin: PC6
run_current: 0.8
#stealthchop_threshold: 999999

[tmc2209 stepper_z1]
uart_pin: PC7
run_current: 0.8
#stealthchop_threshold: 999999

[shaketune]
result_folder: ~/printer_data/config/ShakeTune_results
number_of_results_to_keep: 10
keep_raw_data: False
show_macros_in_webui: True
timeout: 600
measurements_chunk_size: 2
max_freq: 200
dpi: 300

[gcode_arcs]
resolution: 0.1

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PC5

[gcode_macro START_PRINT]
gcode:
	{% set BED_TEMP=params.BED_TEMP|default(60)|float %}
	{% set EXTRUDER_TEMP=params.EXTRUDER_TEMP|default(190)|float %}
	
	# Enables part cooling fan to stop duct from melting when waiting for bed temp
	M106 S153
	
	# Home the printer
	G90
	M83
	G28
	
	# Preheat the bed
	M140 S{BED_TEMP}
	M190 S{BED_TEMP}
	M104 S190
	
	# Z probing sequence
	BED_MESH_CALIBRATE
	
	# Heat the extruder to the desired temperature
	M104 S{EXTRUDER_TEMP}
	M109 S{EXTRUDER_TEMP}
	
	# Prime line sequence
	G1 Z5 F3000 ; lift
	G1 X20 Y5 F1500 ; move to prime position
	G1 Z0.15 F3000 ; get ready to prime
	G92 E0 ; reset extrusion distance
	G1 X200 E30 F600 ; prime nozzle with adjusted extrusion / E__ based on how much you like
	
	# String removal circle after priming
	G1 Z0.2 F3000 ; adjust to 0.2mm above the bed
	G1 Y15 F10000 ; move the toolhead in the Y direction by 15 units
	
	# Execute the circle 3 times
	G2 I-5 J0 F10000 ; circle with 5mm radius
	G2 I-5 J0 F10000
	G2 I-5 J0 F10000

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [beacon model default]
#*# model_coef = 1.4918072075411024,
#*# 	  1.8292873267734675,
#*# 	  0.7544952397763203,
#*# 	  0.20229489964155734,
#*# 	  0.3989946607596949,
#*# 	  1.0734957995018028,
#*# 	  -0.07986018408995176,
#*# 	  -1.2411156357149618,
#*# 	  0.034037729931338565,
#*# 	  0.5377581295928681
#*# model_domain = 1.826046439089027e-07,1.9306903849105157e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 36.864751
#*# model_offset = 0.05000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.157587, 0.167021, 0.180487, 0.199572, 0.182043, 0.186668, 0.177038, 0.158957, 0.157760, 0.115903, 0.148282, 0.125592, 0.149598, 0.168805, 0.152287, 0.168204, 0.156500, 0.158908, 0.161442, 0.175570
#*# 	  0.143778, 0.153354, 0.158883, 0.195256, 0.187090, 0.167291, 0.186637, 0.130155, 0.149903, 0.118832, 0.127301, 0.164453, 0.147130, 0.184941, 0.174831, 0.173573, 0.168553, 0.157377, 0.165260, 0.175226
#*# 	  0.123090, 0.136453, 0.153079, 0.168548, 0.196805, 0.144258, 0.149110, 0.129927, 0.115991, 0.135401, 0.098384, 0.163653, 0.161714, 0.170922, 0.194795, 0.160362, 0.180781, 0.149469, 0.157961, 0.173800
#*# 	  0.151081, 0.129390, 0.177216, 0.172772, 0.154106, 0.193548, 0.123868, 0.154006, 0.120494, 0.121372, 0.155457, 0.126285, 0.187926, 0.168243, 0.173594, 0.176011, 0.160329, 0.180631, 0.170737, 0.181376
#*# 	  0.173420, 0.139740, 0.172501, 0.180639, 0.184015, 0.204261, 0.124915, 0.141250, 0.138611, 0.141002, 0.178806, 0.148919, 0.223095, 0.170511, 0.189616, 0.214005, 0.177986, 0.214202, 0.190240, 0.210906
#*# 	  0.152659, 0.198975, 0.183174, 0.157584, 0.213390, 0.144848, 0.186104, 0.147390, 0.149847, 0.153686, 0.144897, 0.254397, 0.265181, 0.248359, 0.214440, 0.183026, 0.230773, 0.217961, 0.227511, 0.235913
#*# 	  0.147227, 0.174277, 0.129243, 0.159599, 0.152784, 0.143050, 0.163265, 0.088564, 0.161866, 0.134621, 0.166235, 0.264785, 0.271316, 0.305140, 0.186345, 0.183422, 0.209908, 0.175536, 0.225259, 0.204407
#*# 	  0.153265, 0.131950, 0.113882, 0.179232, 0.110754, 0.160080, 0.116418, 0.112607, 0.155785, 0.099383, 0.188056, 0.216246, 0.267511, 0.258050, 0.173538, 0.191412, 0.165695, 0.174641, 0.186371, 0.185012
#*# 	  0.124291, 0.125953, 0.164572, 0.115940, 0.145079, 0.135305, 0.125333, 0.154531, 0.097838, 0.137820, 0.149830, 0.173316, 0.223200, 0.166461, 0.202097, 0.166716, 0.167537, 0.192551, 0.166389, 0.213938
#*# 	  0.113688, 0.113309, 0.149943, 0.107013, 0.172445, 0.141734, 0.134874, 0.160950, 0.101392, 0.166258, 0.139847, 0.147578, 0.184442, 0.134556, 0.189591, 0.168189, 0.168217, 0.168483, 0.161203, 0.208805
#*# 	  0.093755, 0.096400, 0.105841, 0.146702, 0.101135, 0.131356, 0.126199, 0.119735, 0.147973, 0.096920, 0.130042, 0.136277, 0.144976, 0.174540, 0.135969, 0.182208, 0.156132, 0.156428, 0.178282, 0.166120
#*# 	  0.119972, 0.141380, 0.108275, 0.167707, 0.150465, 0.151171, 0.145654, 0.114491, 0.166863, 0.144858, 0.148997, 0.157397, 0.143748, 0.193295, 0.173284, 0.173788, 0.170440, 0.153337, 0.190806, 0.175589
#*# 	  0.136166, 0.159070, 0.166641, 0.175779, 0.204218, 0.159639, 0.175881, 0.171112, 0.172009, 0.199702, 0.158505, 0.185321, 0.192530, 0.196603, 0.218712, 0.187965, 0.205849, 0.209545, 0.214667, 0.228901
#*# 	  0.185845, 0.182358, 0.218977, 0.212847, 0.217202, 0.220676, 0.200411, 0.226977, 0.208314, 0.214436, 0.219018, 0.205814, 0.245894, 0.232498, 0.235562, 0.238679, 0.228236, 0.260254, 0.253473, 0.253535
#*# 	  0.170786, 0.170675, 0.196154, 0.207688, 0.202767, 0.238232, 0.208050, 0.215781, 0.212775, 0.217400, 0.237667, 0.215967, 0.234305, 0.236696, 0.240191, 0.254156, 0.237359, 0.251642, 0.256577, 0.255582
#*# 	  0.123994, 0.157418, 0.173777, 0.192393, 0.205674, 0.207282, 0.229377, 0.215592, 0.211816, 0.213859, 0.208332, 0.233663, 0.220775, 0.233142, 0.235061, 0.227073, 0.240700, 0.225543, 0.231533, 0.230650
#*# 	  0.073665, 0.097188, 0.128842, 0.160559, 0.179631, 0.188754, 0.206877, 0.195721, 0.199376, 0.200418, 0.203489, 0.214638, 0.213382, 0.221941, 0.225837, 0.222007, 0.220013, 0.203948, 0.200197, 0.200408
#*# 	  0.025502, 0.050419, 0.088890, 0.133257, 0.164986, 0.183018, 0.190140, 0.191170, 0.189586, 0.187784, 0.187641, 0.193316, 0.203400, 0.209769, 0.213186, 0.213376, 0.200817, 0.183671, 0.168985, 0.165265
#*# 	  0.009108, 0.039293, 0.082232, 0.131572, 0.161763, 0.182299, 0.192379, 0.194516, 0.195502, 0.196335, 0.194856, 0.198611, 0.208108, 0.218490, 0.224372, 0.220305, 0.208635, 0.189365, 0.171559, 0.166837
#*# 	  0.047733, 0.073428, 0.120230, 0.161921, 0.191057, 0.214635, 0.227698, 0.233414, 0.238009, 0.237180, 0.237174, 0.241931, 0.249917, 0.261184, 0.268523, 0.267244, 0.253397, 0.233971, 0.217034, 0.207634
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 340.0
#*# min_y = 35.0
#*# max_y = 330.0
#*#
#*# [extruder]